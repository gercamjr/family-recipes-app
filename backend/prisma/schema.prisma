generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Recipe {
  id             Int      @id @default(autoincrement())
  titleEn        String   @map("title_en") @db.VarChar(255)
  titleEs        String?  @map("title_es") @db.VarChar(255)
  ingredientsEn  Json     @map("ingredients_en") @db.Json
  ingredientsEs  Json?    @map("ingredients_es") @db.Json
  instructionsEn String   @map("instructions_en")
  instructionsEs String?  @map("instructions_es")
  prepTime       Int?     @map("prep_time")
  cookTime       Int?     @map("cook_time")
  servings       Int?
  tags           String[] @default([])
  categories     String[] @default([])
  isPublic       Boolean  @default(true) @map("is_public")
  createdAt      DateTime @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime @map("updated_at") @db.Timestamptz(6)

  author   User @relation("UserRecipes", fields: [authorId], references: [id])
  authorId Int  @map("user_id")

  comments Comment[] @relation("RecipeComments")
  favorites Favorite[] @relation("RecipeFavorites")
  media    Media[]   @relation("RecipeMedia")

  @@map("recipes")
}

model User {
  id                 Int          @id @default(autoincrement())
  email              String       @unique @db.VarChar(255)
  passwordHash       String       @map("password_hash") @db.VarChar(255)
  role               Role         @default(viewer)
  languagePref       LanguagePref @default(en) @map("language_pref")
  isActive           Boolean      @default(true) @map("is_active")
  inviteToken        String?      @map("invite_token") @db.VarChar(255)
  inviteTokenExpires DateTime?    @map("invite_token_expires") @db.Timestamptz(6)
  createdAt          DateTime     @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime     @map("updated_at") @db.Timestamptz(6)

  recipes         Recipe[]       @relation("UserRecipes")
  comments        Comment[]      @relation("UserComments")
  favorites       Favorite[]     @relation("UserFavorites")
  
  invitedBy   User?  @relation("Invitations", fields: [invitedById], references: [id])
  invitedById Int?   @map("invited_by")
  invites     User[] @relation("Invitations")

  @@map("users")
}

model Comment {
  id        Int      @id @default(autoincrement())
  content   String   @map("comment_text")
  createdAt DateTime @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @map("updated_at") @db.Timestamptz(6)

  author   User   @relation("UserComments", fields: [authorId], references: [id])
  authorId Int    @map("user_id")
  recipe   Recipe @relation("RecipeComments", fields: [recipeId], references: [id])
  recipeId Int    @map("recipe_id")

  @@map("comments")
}

model Favorite {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @map("created_at") @db.Timestamptz(6)

  user     User   @relation("UserFavorites", fields: [userId], references: [id])
  userId   Int    @map("user_id")
  recipe   Recipe @relation("RecipeFavorites", fields: [recipeId], references: [id])
  recipeId Int    @map("recipe_id")

  @@unique([recipeId, userId])
  @@map("favorites")
}

model Media {
  id       Int     @id @default(autoincrement())
  url      String  @map("url")
  type     String  @map("type") // 'image' or 'video'
  filename String? @map("filename")
  size     Int?    @map("size")
  mimeType String? @map("mimeType")

  recipe   Recipe @relation("RecipeMedia", fields: [recipeId], references: [id])
  recipeId Int    @map("recipeId")

  @@map("media")
}

enum LanguagePref {
  en
  es
  @@map("enum_users_languagePref")
}

enum Role {
  admin
  editor
  viewer
  @@map("enum_users_role")
}

